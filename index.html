<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verificando Acesso...</title>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; background-color: #0A0A0A; color: #E5E7EB; display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center; }
        .container { padding: 20px; }
        .spinner { border: 4px solid rgba(230, 0, 122, 0.2); width: 36px; height: 36px; border-radius: 50%; border-left-color: #E6007A; margin: 20px auto; animation: spin 1s ease infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h1 { font-size: 1.5em; margin: 0 0 10px 0; color: #E5E7EB; }
        p { font-size: 1em; color: #808898; }
    </style>
     <script>
        // FB Pixel
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src='https://connect.facebook.net/en_US/fbevents.js';s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script');
    </script>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h1>Verificando seu acesso...</h1>
        <p>Aguarde um momento, estamos te redirecionando em segurança.</p>
    </div>
    <script>
        const OFFER_PAGE_URL = 'https://casalliberal.netlify.app/';
        const WHITE_PAGE_URL = 'https://br.pinterest.com/pin/22095854406665522/';
        const PIXELS_TO_TRACK = [{"id": "1817379038816925"}];

        const isBot = () => /bot|facebook|crawler|spider|preview/i.test(navigator.userAgent);
        const isMobile = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const getCookie = (name) => document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'))?.[2] || null;

        function redirectUser() {
            // Pega todos os parâmetros da URL atual (ex: ?utm_source=...&fbclid=...)
            const queryParams = window.location.search;
            
            // Redireciona para a página de oferta, passando todos os parâmetros
            window.location.replace(`${OFFER_PAGE_URL}${queryParams}`);
        }
        
        function startFlow() {
            // **NOVA REGRA**: Redireciona bots E usuários de desktop. Apenas mobile vai para a oferta.
            if (isBot() || !isMobile()) {
                window.location.replace(WHITE_PAGE_URL);
                return;
            }

            // A lógica de esperar pelo cookie _fbc é para garantir que o pixel do FB capture os dados antes do redirect.
            let attempts = 0;
            const maxAttempts = 15; // Espera no máximo 3 segundos (15 * 200ms)
            const interval = setInterval(() => {
                const fbc = getCookie("_fbc");
                const fbclid = new URLSearchParams(window.location.search).get("fbclid");
                
                // Se o cookie _fbc já existe, OU se não há fbclid (tráfego orgânico/direto), OU se o tempo esgotou, redireciona.
                if (fbc || !fbclid || attempts >= maxAttempts) {
                    clearInterval(interval);
                    redirectUser();
                }
                attempts++;
            }, 200);
        }

        // Inicializa o Pixel e o fluxo
        PIXELS_TO_TRACK.forEach(p => { fbq('init', p.id); });
        fbq('track', 'PageView');
        startFlow();
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1817379038816925&ev=PageView&noscript=1"/></noscript>
</body>
</html>

